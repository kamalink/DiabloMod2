<!DOCTYPE html>
<html lang="ru">
<head>
   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diablo III Mod UI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lora:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <script src="data_economy.js"></script>
    <script src="data_guilds.js"></script>
    <script src="data_classes.js"></script>
    <script src="data_skills.js"></script>
    <script src="data_world.js"></script>
    <script src="logic_core.js"></script>
    <script src="logic_ui.js"></script>
    <script src="logic_game.js"></script>
    <script src="logic_calc.js"></script>
    <script src="logic_main.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="styles_components.css">
</head>
<body>

    <div id="breadcrumb">ГЛАВНАЯ</div>
    <div class="wallpaper"></div>

    <div class="menu-container">
        <div class="header-title" id="menu-title">Diablo III Mod</div>
        <div id="buttons-area"></div>
    </div>

    <div id="text-window">
        <span class="close-x" onclick="closeWindow()">[X]</span>
        <h2 id="window-title"></h2>
        <div id="window-content"></div>
    </div>

    <button id="reset-btn" onclick="resetProgress()">🗑️ СТЕРЕТЬ ВСЕ</button>
    <button id="music-btn" onclick="toggleMusic()">🎵 МУЗЫКА</button>
    <a href="https://randstuff.ru/number/" target="_blank" id="randomizer-btn">🎲 РАНДОМ</a>

    <!-- Виджет изученных навыков -->
    <div id="learned-skills-widget" style="position: fixed; top: 60px; right: 310px; width: 180px; max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.8); border: 1px solid #444; padding: 10px; color: #ccc; font-size: 0.75rem; z-index: 900; display: none; border-radius: 4px;">
        <div style="color: #d4af37; border-bottom: 1px solid #555; margin-bottom: 5px; font-weight: bold; text-align: center;">ИЗУЧЕНО</div>
        <div id="learned-skills-content"></div>
    </div>

    <button id="edit-char-btn" style="top: 60px;" onclick="toggleEditModal()">✍️ КНИГА СУДЕБ</button>

    <!-- Окно смерти -->
    <div id="death-modal">
        <h2>☠️ СМЕРТЬ ГЕРОЯ</h2>
        <div id="death-modal-content"></div>
        <div id="death-modal-actions"></div>
    </div>

    <!-- Контейнер для музыки -->
    <div id="music-player" style="position: fixed; bottom: 0; right: 0; width: 1px; height: 1px; opacity: 0; pointer-events: none;"></div>

    <!-- МОДАЛЬНОЕ ОКНО КАЛЬКУЛЯТОРА НАВЫКОВ -->
    <div id="skill-calc-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 95%; max-width: 700px; max-height: 90vh; background: #1a1a1a; border: 2px solid #d4af37; z-index: 5000; padding: 20px; overflow-y: auto; box-shadow: 0 0 50px #000;">
        <h2 style="color: #d4af37; text-align: center; font-family: 'Cinzel', serif; margin-top: 0;">🧮 КАЛЬКУЛЯТОР НАВЫКОВ</h2>
        <span class="close-x" onclick="document.getElementById('skill-calc-modal').style.display='none'">[X]</span>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Левая часть: Выбор -->
            <div>
                <label style="color: #aaa;">Класс:</label>
                <select id="calc-class-select" class="d2-button" style="padding: 5px; margin: 5px 0;" onchange="updateCalcSkills()"></select>
                
                <label style="color: #aaa;">Навык:</label>
                <select id="calc-skill-select" class="d2-button" style="padding: 5px; margin: 5px 0;" onchange="updateCalcRunes()"></select>
                
                <label style="color: #aaa;">Руна:</label>
                <select id="calc-rune-select" class="d2-button" style="padding: 5px; margin: 5px 0;" onchange="loadCalcSkillData()"></select>
                
                <hr style="border-color: #333;">
                
                <div style="margin-bottom: 5px;"><span style="color: #66ccff;">⚔️ Урон:</span> <span id="calc-dmg" style="color: #e0e0e0;">0</span>%</div>
                <div style="margin-bottom: 5px;"><span style="color: #a29bfe;">🎯 Область:</span> <span id="calc-aoe" style="color: #e0e0e0;" data-value="1">-</span></div>
            </div>

            <!-- Правая часть: Доп параметры -->
            <div>
                <div><span style="color: #ff7979;">❄️ Замедление:</span> <span id="calc-slow" style="color: #e0e0e0;">0</span>%</div>
                <div><span style="color: #ff7979;">⚡ Стан/Фриз:</span> <span id="calc-stun" style="color: #e0e0e0;">0</span> сек</div>
                <div><span style="color: #66ff66;">❤️ Лечение:</span> <span id="calc-heal" style="color: #e0e0e0;">0</span>% HP</div>
                <div><span style="color: #ffd700;">🛡️ Бафф Урона:</span> <span id="calc-buff-dmg" style="color: #e0e0e0;">0</span>%</div>
                <div><span style="color: #ffd700;">🛡️ Бафф Защиты:</span> <span id="calc-buff-def" style="color: #e0e0e0;">0</span>%</div>
                <div><span style="color: #a29bfe;">⚡ Эффективность:</span> <span id="calc-eff-inc" style="color: #e0e0e0;">0</span>%</div>
                <div><span style="color: #66ccff;">🌀 Восст. ресурса:</span> <span id="calc-res-gain" style="color: #e0e0e0;">0</span></div>
                <input type="hidden" id="calc-buff-perm" value="false"> <!-- Скрытое поле для постоянных баффов -->
                <input type="hidden" id="calc-buff-duration" value="0"> <!-- Длительность баффа -->
                <input type="hidden" id="calc-dmg-amp" value="0"> <!-- Усиление урона по врагам -->
                <input type="hidden" id="calc-dmg-2" value="0"> <!-- Второй источник урона -->
                <input type="hidden" id="calc-aoe-2" value="1"> <!-- Область второго источника -->
                
                <div id="calc-synergy-box" style="display:none; margin-top:10px; border-top: 1px dashed #444; padding-top: 5px;">
                    <label style="color: #ff9900; font-size: 0.8rem;">⚔️ Лучший навык атаки:</label>
                    <select id="calc-synergy-skill" class="d2-button" style="padding: 3px; font-size: 0.75rem; margin: 3px 0;" onchange="calculateSkillCost()"></select>
                </div>
                <input type="hidden" id="calc-cost-red-flat" value="0"> <!-- Скрытое поле для снижения затрат (плоское) -->
                
                <div id="calc-skill-cost-box" style="display:none; margin-top:5px;">
                    <label style="color: #a29bfe;">📉 Цена осн. навыка:</label> <input type="number" id="calc-main-skill-cost" style="width: 80px;" value="0" oninput="calculateSkillCost()">
                </div>
            </div>
        </div>

        <div style="margin-top: 20px; text-align: center; border-top: 1px solid #5a0000; padding-top: 10px;">
            <div style="font-size: 1.5rem; color: #d4af37; display: flex; align-items: center; justify-content: center;">
                <span>СТОИМОСТЬ: <span id="calc-result" style="font-weight: bold; color: #fff;">0</span> 📖</span>
                <button class="buy-skill-btn" onclick="buySkill()">ИЗУЧИТЬ</button>
            </div>
            <p id="calc-details" style="font-size: 0.8rem; color: #888; margin-top: 5px;"></p>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО КАЛЬКУЛЯТОРА ОПЫТА -->
    <div id="exp-calc-modal">
        <span class="close-x" onclick="document.getElementById('exp-calc-modal').style.display='none'">[X]</span>
        <h3>📊 ПОДСЧЕТ ОПЫТА</h3>
        
        <div class="exp-input-row">
            <label>💀 Мобы:</label>
            <input type="number" id="exp-mobs" value="0" oninput="calculateExp()">
        </div>
        <div class="exp-input-row">
            <label>☠️ Элита:</label>
            <input type="number" id="exp-elites" value="0" oninput="calculateExp()">
        </div>
        <div class="exp-input-row">
            <label>👹 Боссы:</label>
            <input type="number" id="exp-bosses" value="0" oninput="calculateExp()">
        </div>

        <div class="exp-result-box" id="exp-result-display">Введите данные...</div>
        <button class="exp-apply-btn" onclick="applyExpCalculation()">✅ ПРИМЕНИТЬ</button>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ПОКУПКИ ЗАКЕНОВ -->
    <div id="zaken-buy-modal">
        <span class="close-x" onclick="document.getElementById('zaken-buy-modal').style.display='none'">[X]</span>
        <h3>💰 ПОКУПКА ЗАКЕНОВ</h3>
        <p id="zaken-price-display" style="color: #aaa; font-size: 0.9rem;"></p>
        
        <label>Количество:</label><br>
        <input type="number" id="zaken-count-input" value="1" min="1" oninput="updateZakenTotalCost()">
        <div id="zaken-total-cost" style="margin: 10px 0; font-weight: bold; color: #ffd700;">Итого: 0🥈</div>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button id="btn-confirm-buy" class="zaken-buy-btn" onclick="confirmBuyZakens()">КУПИТЬ</button>
            <button id="btn-confirm-sell" class="zaken-sell-btn" onclick="confirmSellZakens()">ПРОДАТЬ</button>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ДЛЯ ВВОДА ЧИСЛА -->
    <div id="custom-prompt-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 7000; align-items: center; justify-content: center;">
        <div id="prompt-content" style="width: 90%; max-width: 400px; background: linear-gradient(160deg, #1a0505 0%, #000 100%); border: 2px solid #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); padding: 25px; text-align: center; font-family: 'Cinzel', serif; color: #e0e0e0;">
            <h3 id="prompt-title" style="color: #d4af37; margin-top: 0; font-size: 1.5rem;"></h3>
            <p id="prompt-text" style="font-family: 'Lora', serif; font-size: 1.1rem; margin: 20px 0; line-height: 1.5;"></p>
            <input type="number" id="prompt-input" value="1" min="1" style="width: 100px; padding: 8px; background: #000; border: 1px solid #444; color: #fff; text-align: center; font-size: 1.2rem; margin-bottom: 20px;">
            <div id="prompt-buttons" style="display: flex; justify-content: center; gap: 15px;">
                <button id="prompt-ok-btn" class="death-confirm-btn" style="background: #5a0000; border-color: #d4af37; min-width: 100px;">OK</button>
                <button id="prompt-cancel-btn" class="death-cancel-btn" style="min-width: 100px;">Отмена</button>
            </div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ПРОДАЖИ КРАФТА -->
    <div id="sell-craft-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 95%; max-width: 600px; max-height: 90vh; background: #1a1a1a; border: 2px solid #d4af37; z-index: 6000; padding: 20px; overflow-y: auto; box-shadow: 0 0 50px #000;">
        <h2 style="color: #d4af37; text-align: center; font-family: 'Cinzel', serif; margin-top: 0;">Продажа крафченого предмета</h2>
        <span class="close-x" onclick="document.getElementById('sell-craft-modal').style.display='none'">[X]</span>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
            <div>
                <label>Уровень предмета: <input type="number" id="craft-sell-level" value="1" min="1" oninput="calculateCraftedSellPrice()" style="width: 60px;"></label>
            </div>
            <div>
                <label>Грейд: 
                    <select id="craft-sell-grade" onchange="calculateCraftedSellPrice()" style="margin-right: 10px;">
                        <option value="N">N (📓)</option>
                        <option value="DC">D/C (📘📒)</option>
                        <option value="B">B (📙)</option>
                        <option value="A">A (📕)</option>
                        <option value="S">S (Древний)</option>
                        <option value="S+">S+ (Комплект)</option>
                        <option value="Spectrum">Spectrum</option>
                    </select>
                </label>
                <span id="craft-sell-guild-bonus" style="font-size: 0.8rem; color: #66ff66;"></span>
            </div>
        </div>

        <div id="craft-sell-properties" style="background: rgba(0,0,0,0.2); border: 1px solid #333; padding: 10px; max-height: 200px; overflow-y: auto; margin-bottom: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
            <!-- Свойства для выбора будут здесь -->
        </div>

        <div id="craft-sell-total" style="text-align: center; font-size: 1.4rem; color: #ffd700; margin: 20px 0; font-family: 'Cinzel', serif;">Итоговая цена: 0 🧧</div>
        
        <div style="text-align: center;"><button class="death-confirm-btn" onclick="confirmSellCraftedItem()">ПРОДАТЬ</button></div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО УСЛУГ ЮВЕЛИРА -->
    <div id="gem-service-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 7000; align-items: center; justify-content: center;">
        <div style="width: 90%; max-width: 450px; background: linear-gradient(160deg, #1a0505 0%, #000 100%); border: 2px solid #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); padding: 25px; text-align: center; font-family: 'Cinzel', serif; color: #e0e0e0;">
            <h3 id="gem-service-title" style="color: #d4af37; margin-top: 0; font-size: 1.5rem;">Услуги ювелира</h3>
            <div id="gem-service-inputs" style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0;">
                <label>Ранг 💎 (1-10): <input type="number" id="gem-rank-input" value="1" min="1" max="10" style="width: 80px; padding: 5px; background: #000; border: 1px solid #444; color: #fff;"></label>
                <label>Количество: <input type="number" id="gem-quantity-input" value="1" min="1" style="width: 80px; padding: 5px; background: #000; border: 1px solid #444; color: #fff;"></label>
                <label id="gem-rent-duration-box" style="display:none;">На сколько уровней: <input type="number" id="gem-rent-duration" value="1" min="1" style="width: 80px; padding: 5px; background: #000; border: 1px solid #444; color: #fff;"></label>
                <div id="gem-item-type-selector" style="display: flex; gap: 15px; justify-content: center; margin-top: 5px; font-size: 0.9rem;">
                    <label style="cursor: pointer;"><input type="radio" name="gem-item-type" value="1" checked> Оружие (х1)</label>
                    <label style="cursor: pointer;"><input type="radio" name="gem-item-type" value="0.5"> Другое (х0.5)</label>
                </div>
            </div>
            <div id="gem-service-buttons" style="display: flex; justify-content: center; gap: 15px; margin-top: 20px;">
                <!-- Buttons will be generated here by JS -->
            </div>
        </div>
    </div>

    <!-- МОДАЛЬНОЕ ОКНО ПРОДАЖИ РЕСУРСОВ -->
    <div id="multi-sell-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 7000; align-items: center; justify-content: center;">
        <div style="width: 90%; max-width: 450px; background: linear-gradient(160deg, #1a0505 0%, #000 100%); border: 2px solid #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2); padding: 25px; text-align: center; font-family: 'Cinzel', serif; color: #e0e0e0;">
            <h3 id="multi-sell-title" style="color: #d4af37; margin-top: 0; font-size: 1.5rem;">Продажа ресурсов</h3>
            <div style="margin-bottom: 15px;">
                <label>Уровень ресурсов: <input type="number" id="multi-sell-level" value="1" min="1" style="width: 80px; padding: 5px; background: #000; border: 1px solid #444; color: #fff;"></label>
            </div>
            <div id="multi-sell-inputs" style="display: flex; flex-direction: column; gap: 15px; margin: 20px 0; text-align: left;">
                <!-- Inputs will be generated here by JS -->
            </div>
            <div id="multi-sell-total" style="font-size: 1.2rem; color: #ffd700; margin-bottom: 20px;">Итого: 0 🧧</div>
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button id="multi-sell-ok-btn" class="death-confirm-btn">Продать</button>
                <button id="multi-sell-cancel-btn" class="death-cancel-btn">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Окно подтверждения (Generic) -->
    <div id="custom-confirm-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 7000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: linear-gradient(160deg, #1a0505 0%, #000 100%); border: 2px solid #d4af37; box-shadow: 0 0 30px rgba(212, 175, 55, 0.2), inset 0 0 50px rgba(50, 20, 0, 0.5); padding: 25px; text-align: center; font-family: 'Cinzel', serif; font-weight: 700; color: #e0e0e0; border-radius: 4px;">
            <h3 id="confirm-title" style="color: #d4af37; margin-top: 0; text-shadow: 0 0 10px #500; font-size: 1.5rem;">⚠️ ВНИМАНИЕ</h3>
            <div id="confirm-message" style="font-family: 'Lora', serif; font-size: 1.1rem; margin: 20px 0; line-height: 1.5;"></div>
            <div style="display: flex; justify-content: center; gap: 15px;">
                <button id="confirm-yes-btn" class="death-confirm-btn" style="background: #5a0000; border-color: #d4af37; min-width: 100px;">ДА</button>
                <button id="confirm-no-btn" class="death-cancel-btn" style="min-width: 100px;">ОТМЕНА</button>
            </div>
        </div>
    </div>

    <!-- Нижнее меню для мобильных -->
    <div id="mobile-nav-bar">
        <button class="mobile-nav-btn" onclick="toggleMobilePanel('char-sheet', this)">👤 ГЕРОЙ</button>
        <button class="mobile-nav-btn" onclick="toggleMobilePanel('right-panels-stack', this)">📜 БОНУСЫ</button>
        <button class="mobile-nav-btn" onclick="toggleEditModal()">✍️ КНИГА</button>
    </div>

<div id="char-sheet">
    <div style="text-align: center; color: #d4af37; font-size: 1.2rem; margin-bottom: 10px;" id="view-name">НЕФАЛЕМ</div>
    
    <div class="stat-group">
        <div class="stat-group-title">Куб (Пентограмма)</div>
        <div style="text-align: center; margin-top: 5px; display: flex; justify-content: center; gap: 5px;">
            <div id="slot-penta-1" class="penta-slot" title="Слот 1 (25 ВП)"></div>
            <div id="slot-penta-2" class="penta-slot" title="Слот 2 (60 ВП)"></div>
            <div id="slot-penta-3" class="penta-slot" title="Слот 3 (100 ВП)"></div>
        </div>
    </div>

    <div class="stat-group">
        <div class="stat-group-title">Герой & Билд</div>
        <div class="stat-row"><span id="view-class">Класс не выбран</span> <span id="view-build" style="font-size:0.7rem;"></span></div>
        <div class="stat-row">Уровень: <span id="view-lvl" class="stat-value">1</span> 🌒</div>
        <div class="stat-row">Зелья: <span id="view-potions" class="stat-value">5</span> 💊 <span id="view-potion-price" style="font-size: 0.7rem;"></span></div>
        <!-- Характеристики гильдий -->
        <div class="stat-row" id="view-stat-str-row">Сила: <span id="view-stat-str" class="stat-value">0</span> 🏮</div>
        <div class="stat-row" id="view-stat-dex-row">Ловкость: <span id="view-stat-dex" class="stat-value">0</span> 🥢</div>
        <div class="stat-row" id="view-stat-int-row">Интеллект: <span id="view-stat-int" class="stat-value">0</span> 🔮</div>
        <div class="stat-row" id="view-stat-vit-row">Живучесть: <span id="view-stat-vit" class="stat-value">0</span> ⛑️</div>
        <div class="stat-row">Макс ВП: <span id="view-max-vp" class="stat-value">0</span> 🏛️</div>
    </div>

    <div class="stat-group">
        <div class="stat-group-title">Финансы</div>
        <div class="money-row">
            <span class="money-unit"><span id="view-gold-g">0</span>🥇</span>
            <span class="money-unit"><span id="view-gold-s">0</span>🥈</span>
            <span class="money-unit"><span id="view-gold-c">0</span>🥉</span>
            <span class="money-unit"><span id="view-gold-y">0</span>🧧</span>
        </div>
    <div class="stat-row" style="margin-top:8px;">Руны: <span id="view-runes" class="stat-value">0</span> 📖</div>
        <div class="stat-row">Парагон: <span id="view-para" class="stat-value">0</span> ⏳</div>
        <div class="stat-row" style="font-size: 0.7rem;">Бонус опыта: <span id="view-xp-bonus">-</span></div>
    <div class="stat-row">Закены: <span id="view-zakens" class="stat-value">0</span> 🔖 <span id="view-zaken-discount" style="font-size: 0.7rem;"></span></div>
    </div>

    <div class="stat-group">
        <div class="stat-group-title">Гильдия & Ранг</div>
        <div class="stat-row">Орден: <span id="view-guild" class="stat-value">Нет</span></div>
        <div class="stat-row">Ранг: <span id="view-rank" class="stat-value">0</span> 🧾</div>
        <div class="stat-row">Продано рун: <span id="view-runes-sold" class="stat-value">0</span> 📖</div>
        <div class="stat-row">Репутация: <span id="view-reputation" class="stat-value">0</span> 🎭</div>
        <div class="stat-row">Сделки: <span id="view-deals" class="stat-value">0</span> 🤝</div>
        <div class="stat-row">Сундуки: <span id="view-chests" class="stat-value">0</span> 📦</div>
    </div>

    <div class="stat-group">
        <div class="stat-row">Куплено на ЧР: <span id="view-black-market" class="stat-value">0</span> 🕶️</div>
        <div class="stat-row">Украдено: <span id="view-steals" class="stat-value">0</span> <span id="view-theft-fine" style="font-size: 0.6rem;"></span></div>
    </div>

    <div class="stat-group">
        <div class="stat-group-title">Статистика & Лут</div>
        <div class="stat-row">Убито мобов: <span id="view-kills" class="stat-value">0</span> 💀</div>
        <div class="stat-row">Элита (соло): <span id="view-elites-solo" class="stat-value">0</span> ☠️</div>
        <div class="stat-row">Боссы: <span id="view-bosses" class="stat-value">0</span> 👹</div>
        <div class="stat-row">Гоблины: <span id="view-gobs-solo" class="stat-value">0</span>(С) / <span id="view-gobs-assist" class="stat-value">0</span>(П)</div>
        <div class="stat-row">Найдено Лег: <span id="view-found-legs" class="stat-value">0</span> 📙</div>
        <div class="stat-row">Найдено Желтых: <span id="view-found-yellows" class="stat-value">0</span> 📒</div>
        <div class="stat-row">Ресурсы: <span id="view-res-n" class="stat-value">0</span>📓 <span id="view-res-dc" class="stat-value">0</span>📘📒 <span id="view-res-b" class="stat-value">0</span>📙 <span id="view-res-a" class="stat-value">0</span>📕</div>
        <div class="stat-row">Реагенты: <span id="view-reagents" class="stat-value">0</span></div>
        <div class="stat-row">Дыхание смерти: <span id="view-death-breath" class="stat-value">0</span> 🧪</div>
        <div class="stat-row" style="font-size: 0.7rem;">Портал 70: <span id="view-lvl70-portal">-</span></div>
    </div>
</div>

<div id="edit-modal" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #1a1a1a; border: 3px solid #d4af37; padding: 20px; z-index: 2000; color: white; font-family: 'Lora', serif; width: 600px; max-height: 90vh; overflow-y: auto;">
    <h2 style="color:#d4af37; text-align:center;">КНИГА СУДЕБ</h2>
    
    <div class="edit-grid">
        <!-- ЛЕВАЯ КОЛОНКА -->
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <h4 style="color: #66ccff; margin: 0;">ОСНОВНОЕ</h4>
            <label>Имя: <input type="text" id="input-name" style="width: 100%;"></label>
            <label>Класс: 
                <select id="input-class" style="width: 100%; background: #333; color: white; border: 1px solid #555;">
                    <option value="Класс не выбран">Не выбран</option>
                    <option value="Варвар">Варвар</option>
                    <option value="Крестоносец">Крестоносец</option>
                    <option value="Охотник на демонов">Охотник на демонов</option>
                    <option value="Монах">Монах</option>
                    <option value="Колдун">Колдун</option>
                    <option value="Чародей">Чародей</option>
                </select>
            </label>
            <label>Уровень 🌒: <input type="number" step="0.1" id="input-lvl" style="width: 60px;"></label>
            <label>Зелья 💊: <input type="number" id="input-potions" style="width: 60px;"></label>
            
            <!-- Поля "Изначально" (скрываются если > 0) -->
            <div id="input-base-kills-box"><label>Изнач. мобов: <input type="number" id="input-base-kills" style="width: 60px;"></label></div>
            <div id="input-base-elites-box"><label>Изнач. элиток: <input type="number" id="input-base-elites" style="width: 60px;"></label></div>
            
            <!-- Характеристики гильдий (скрыты по умолчанию) -->
            <div id="input-stat-str-box"><label>Сила 🏮: <input type="number" id="input-stat-str" style="width: 60px;"></label></div>
            <div id="input-stat-dex-box"><label>Ловкость 🥢: <input type="number" id="input-stat-dex" style="width: 60px;"></label></div>
            <div id="input-stat-int-box"><label>Интеллект 🔮: <input type="number" id="input-stat-int" style="width: 60px;"></label></div>
            <div id="input-stat-vit-box"><label>Живучесть ⛑️: <input type="number" id="input-stat-vit" style="width: 60px;"></label></div>
            
            <h4 style="color: #ffd700; margin: 5px 0 0 0;">ФИНАНСЫ</h4>
            <label>Золото 🥇: <input type="number" step="0.1" id="input-gold-g" style="width: 60px;"></label>
            <label>Золото 🥈: <input type="number" step="0.1" id="input-gold-s" style="width: 60px;"></label>
            <label>Золото 🥉: <input type="number" step="0.1" id="input-gold-c" style="width: 60px;"></label>
            <label>Золото 🧧: <input type="number" step="0.1" id="input-gold-y" style="width: 60px;"></label>
            <label>Руны 📖: <input type="number" step="0.1" id="input-runes" style="width: 60px;"></label>
            <label>Парагон ⏳: <input type="number" step="0.1" id="input-para" style="width: 60px;"></label>
            <label>Закены 🔖: <input type="number" id="input-zakens" style="width: 60px;"></label>

            <h4 style="color: #ff7979; margin: 5px 0 0 0;">БОЙ И ПРОГРЕСС</h4>
            <label>Мобы 💀: <input type="number" id="input-kills" style="width: 80px;"></label>
            <label>Элита (Сам) ☠️: <input type="number" id="input-elites-solo" style="width: 80px;"></label>
            <label>Боссы 👹: <input type="number" id="input-bosses" style="width: 80px;"></label>
            <label>Гоблины (Сам) ⭐: <input type="number" id="input-gobs-solo" style="width: 80px;"></label>
            <label>Гоблины (Помощь) 🤝: <input type="number" id="input-gobs-assist" style="width: 80px;"></label>
            <label>Макс ВП 🏛️: <input type="number" id="input-max-vp" style="width: 60px;"></label>
            <label>Портал 70 ур.: <input type="number" id="input-lvl70-portal" style="width: 60px;"></label>
        </div>

        <!-- ПРАВАЯ КОЛОНКА -->
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <h4 style="color: #a29bfe; margin: 0;">ЛУТ И РЕСУРСЫ</h4>
            <label>Найдено Лег 📙: <input type="number" id="input-found-legs" style="width: 60px;"></label>
            <label>Найдено Желтых 📒: <input type="number" id="input-found-yellows" style="width: 60px;"></label>
            <label>Дыхание смерти 🧪: <input type="number" id="input-death-breath" style="width: 60px;"></label>
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px; flex-wrap: wrap; align-items: center;">
                <label style="font-size: 0.9rem;">📓: <input type="number" id="input-res-n" style="width: 40px;"></label>
                <label style="font-size: 0.9rem;">📘📒: <input type="number" id="input-res-dc" style="width: 40px;"></label>
                <label style="font-size: 0.9rem;">📙: <input type="number" id="input-res-b" style="width: 40px;"></label>
                <label style="font-size: 0.9rem;">📕: <input type="number" id="input-res-a" style="width: 40px;"></label>
            </div>
            <label>Реагенты: <input type="number" id="input-reagents" style="width: 60px;"></label>

            <h4 style="color: #55efc4; margin: 5px 0 0 0;">ГИЛЬДИЯ И ТЕНЬ</h4>
            <label>Продано Рун 📖: <input type="number" step="0.1" id="input-runes-sold" style="width: 60px;"></label>
            <label>Репутация 🎭: <input type="number" id="input-reputation" style="width: 60px;"></label>
            <label>Сделки : <input type="number" id="input-deals" style="width: 60px;"></label>
            <label>Сундуки 📦: <input type="number" id="input-chests" style="width: 60px;"></label>
            <label>Украдено: <input type="number" id="input-steals" style="width: 60px;"></label>
            <label>Куплено на ЧР 🕶️: <input type="number" id="input-black-market" style="width: 60px;"></label>
        </div>
    </div>
        
    <div style="margin-top: 20px; text-align: center;">
        <button onclick="savePlayerData()" style="background: #d4af37; color: black; padding: 10px 20px; border: none; cursor: pointer; font-weight: bold; margin-right: 10px;">СОХРАНИТЬ</button>
        <button onclick="toggleEditModal()" style="background: #5a0000; color: white; padding: 10px 20px; border: none; cursor: pointer;">ОТМЕНА</button>
    </div>
</div>

<div id="right-panels-stack" style="position: fixed; right: 15px; top: 120px; width: 240px; z-index: 3000; display: flex; flex-direction: column; gap: 10px;">
    
    <!-- Свиток ГИЛЬДИИ -->
    <div id="active-guild-bonus" class="right-panel-bonus" style="display: none; background: linear-gradient(180deg, #1a1a1a 0%, #050505 100%); border: 1px solid #d4af37; padding: 12px; color: #e0e0e0; font-family: 'Marcellus', serif; box-shadow: 0 5px 15px rgba(0,0,0,0.8); border-radius: 2px;">
        <h4 id="bonus-guild-name" style="margin: 0 0 10px 0; color: #d4af37; text-align: center; border-bottom: 1px solid #5a0000; font-size: 0.9rem;">ГИЛЬДИЯ</h4>
        <div id="bonus-content" style="font-size: 0.7rem;"></div>
    </div>

    <!-- Свиток КЛАССА -->
    <div id="active-class-bonus" class="right-panel-bonus" style="display: none; background: linear-gradient(180deg, #1a1a1a 0%, #0a0a1a 100%); border: 1px solid #66ccff; padding: 12px; color: #e0e0e0; font-family: 'Marcellus', serif; box-shadow: 0 5px 15px rgba(0,0,0,0.8); border-radius: 2px;">
        <h4 id="bonus-class-name" style="margin: 0 0 10px 0; color: #66ccff; text-align: center; border-bottom: 1px solid #003366; font-size: 0.9rem;">БИЛД</h4>
        <div id="class-bonus-content" style="font-size: 0.7rem;"></div>
    </div>

</div>

<!-- ЭКРАН БЕЗДЕЙСТВИЯ (DIABLO) -->
<div id="idle-screen">
        <img id="idle-diablo-img" src="https://upload.wikimedia.org/wikipedia/en/d/d5/Diablo_III_cover.png" onerror="this.style.display='none'" alt="Diablo">
    <div class="fire-wrapper">
        <h1 class="fire-text">ЗЛО НЕ ДРЕМЛЕТ...</h1>
        <div class="spark spark-1"></div>
        <div class="spark spark-2"></div>
        <div class="spark spark-3"></div>
        <div class="spark spark-4"></div>
        <div class="spark spark-5"></div>
        <div class="spark spark-6"></div>
    </div>
</div>

</body>
</html>
